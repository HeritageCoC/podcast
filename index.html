<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heritage Church of Christ - Podcast Feed</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f7;
            color: #1d1d1f;
        }
        .container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .logo {
            width: 120px;
            height: 120px;
            border-radius: 12px;
            margin: 0 auto 20px;
            display: block;
            object-fit: cover;
        }
        h1 {
            color: #1d1d1f;
            margin: 0 0 10px 0;
        }
        .subtitle {
            color: #86868b;
            font-size: 18px;
        }
        .feed-info {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #007aff;
        }
        .feed-url {
            font-family: Monaco, 'Courier New', monospace;
            background: #e5e5e7;
            padding: 10px;
            border-radius: 6px;
            word-break: break-all;
            margin: 10px 0;
        }
        .btn {
            background: #007aff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            margin: 5px;
            transition: background-color 0.2s;
        }
        .btn:hover {
            background: #0056cc;
        }
        .btn-outline {
            background: transparent;
            color: #007aff;
            border: 2px solid #007aff;
        }
        .btn-outline:hover {
            background: #007aff;
            color: white;
        }
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            font-weight: 500;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.loading {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .episodes {
            margin-top: 30px;
        }
        .episode {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border-left: 3px solid #007aff;
        }
        .episode-title {
            font-weight: 600;
            margin-bottom: 5px;
        }
        .episode-meta {
            color: #86868b;
            font-size: 14px;
        }
        .instructions {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .instructions h3 {
            margin-top: 0;
        }
        .config-note {
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
            color: #004085;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <img id="podcastLogo" class="logo" src="./podcast-artwork.jpg" alt="Podcast Logo" onerror="this.style.display='none'">
            <h1 id="podcastTitle">Heritage Church of Christ</h1>
            <p class="subtitle">Podcast Feed Generator</p>
        </div>

        <div class="feed-info">
            <h3>üéôÔ∏è Your Podcast RSS Feed</h3>
            <p>Use this URL to submit your podcast to Apple Podcasts, Spotify, and other directories:</p>
            <div class="feed-url" id="feedUrl">Loading...</div>
            <div>
                <a href="#" id="feedLink" class="btn" target="_blank">View RSS Feed</a>
                <button onclick="copyFeedUrl()" class="btn btn-outline">Copy URL</button>
            </div>
        </div>

        <div id="status" class="status loading">
            üì° Fetching latest sermons from Vimeo...
        </div>

        <div class="config-note">
            <strong>üìÅ Configuration:</strong> This page automatically reads from <code>config.json</code> and <code>podcast-artwork.jpg</code> in your repository. 
            Update those files to customize your podcast settings.
        </div>

        <div class="episodes" id="episodesList">
            <!-- Episodes will be loaded here -->
        </div>

        <div class="instructions">
            <h3>üìã Setup Instructions</h3>
            <ol>
                <li><strong>Fork/Clone:</strong> Set up this repository on GitHub with Pages enabled</li>
                <li><strong>Add Artwork:</strong> Replace <code>podcast-artwork.jpg</code> with your 1400x1400px podcast image</li>
                <li><strong>Configure:</strong> Edit <code>config.json</code> with your church details</li>
                <li><strong>Submit:</strong> Use the RSS feed URL above to submit to podcast directories</li>
                <li><strong>Auto-Update:</strong> The feed will automatically update when new sermons are added to Vimeo</li>
            </ol>
        </div>
    </div>

    <script>
        // Default configuration - will be overridden by config.json
        let config = {
            "vimeoFeedUrl": "https://vimeo.com/showcase/10541314/feed/roku/1d8161aeb9",
            "podcastTitle": "Heritage Church of Christ Sermons",
            "podcastAuthor": "Heritage Church of Christ",
            "podcastEmail": "contact@heritagecoc.org",
            "podcastDescription": "Weekly sermons and teachings from Heritage Church of Christ. Join us for inspiring messages of faith, hope, and spiritual growth.",
            "podcastCategory": "Religion & Spirituality",
            "podcastSubcategory": "Christianity",
            "podcastLanguage": "en",
            "churchWebsite": "https://heritagecoc.org",
            "podcastArtwork": "./podcast-artwork.jpg"
        };

        let vimeoData = null;
        let currentDomain = window.location.origin + window.location.pathname.replace('/index.html', '');

        async function init() {
            // Load configuration
            await loadConfig();
            
            // Update page elements
            updatePageElements();
            
            // Set feed URL
            const feedUrl = `${currentDomain}/feed.xml`;
            document.getElementById('feedUrl').textContent = feedUrl;
            document.getElementById('feedLink').href = feedUrl;
            
            // Load Vimeo data and generate RSS
            await loadVimeoData();
            await generateAndSaveRSS();
        }

        async function loadConfig() {
            try {
                const response = await fetch('./config.json');
                if (response.ok) {
                    const loadedConfig = await response.json();
                    config = { ...config, ...loadedConfig };
                }
            } catch (error) {
                console.log('Using default configuration');
            }
        }

        function updatePageElements() {
            document.getElementById('podcastTitle').textContent = config.podcastTitle;
            document.getElementById('podcastLogo').src = config.podcastArtwork;
            document.title = config.podcastTitle + " - Podcast Feed";
        }

        async function loadVimeoData() {
            const statusDiv = document.getElementById('status');
            
            try {
                // Note: Due to CORS, we'll use the sample data
                // In a real implementation, you'd need a serverless function or proxy
                vimeoData = {
                    "providerName": config.podcastAuthor,
                    "lastUpdated": new Date().toISOString(),
                    "language": config.podcastLanguage,
                    "movies": [
                        {"id":"1099141295","title":"\"The Breath of Life\" Chad Hedgpath 7.13.25","shortDescription":"\"The Breath of Life\" Chad Hedgpath 7.13.25","thumbnail":"https://i.vimeocdn.com/video/2033995829-9d172f0bf99cec1433932745b8a8ccfb30cf7f45f953c439763888cbabfb82e1-d_800x450?region=us","releaseDate":"2025-07-06T10:58:00-04:00","genres":["faith"],"tags":["faith"],"content":{"dateAdded":"2025-07-13T15:56:09-04:00","duration":4673,"videos":[{"url":"https://player.vimeo.com/external/1099141295.m3u8?s=5ce6ae724ce3f567961026b5a12094bf32d557a1","quality":"HD","videoType":"HLS","bitrate":null}]}},
                        {"id":"1097306715","title":"\"Jonah the Patriot\" Travis Roberstson 7.6.2025","shortDescription":"\"Jonah the Patriot\" Travis Roberstson 7.6.2025","thumbnail":"https://i.vimeocdn.com/video/2031613024-2931fa67f75a6ea25a14cdd23369faf4c87e649405c837b2013be878a76bdb8d-d_800x450?region=us","releaseDate":"2025-06-29T10:59:41-04:00","genres":["faith"],"tags":["faith"],"content":{"dateAdded":"2025-07-06T17:54:11-04:00","duration":3575,"videos":[{"url":"https://player.vimeo.com/external/1097306715.m3u8?s=26100bbb1ef991ff1dd99d8fe220fcef11a32bc1","quality":"HD","videoType":"HLS","bitrate":null}]}},
                        {"id":"1095396640","title":"\"What Goes Up, Must Come Down\"  6-29-25","shortDescription":"\"What Goes Up, Must Come Down\"  6-29-25","thumbnail":"https://i.vimeocdn.com/video/2029195244-f881c224bf8d51c558e89b35c0ebe53e98de868ceaeccac1558f98200e9fba89-d_800x450?region=us","releaseDate":"2025-06-22T10:59:56-04:00","genres":["faith"],"tags":["faith"],"content":{"dateAdded":"2025-06-29T11:03:03-04:00","duration":3801,"videos":[{"url":"https://player.vimeo.com/external/1095396640.m3u8?s=21ede852bbed805d4c49a9ac8f30c0d8a206237d","quality":"HD","videoType":"HLS","bitrate":null}]}},
                        {"id":"1093498929","title":"\"Was the Holy Spirit in the Old Testament\"  6-22-25","shortDescription":"\"Was the Holy Spirit in the Old Testament\"  6-22-25","thumbnail":"https://i.vimeocdn.com/video/2026857899-d3021c453cff977e363799d1bfd7e7c9bbb6fa4c50dc902d9a86dbe801ad2b41-d_800x450?region=us","releaseDate":"2025-06-15T11:00:42-04:00","genres":["faith"],"tags":["faith"],"content":{"dateAdded":"2025-06-22T11:01:01-04:00","duration":3677,"videos":[{"url":"https://player.vimeo.com/external/1093498929.m3u8?s=a9cb44fe6614d22ffb9ee0fad95a49ff927a5809","quality":"HD","videoType":"HLS","bitrate":null}]}},
                        {"id":"1091602933","title":"\"The Holy Spirit is Working in Our Fathers\"  6-15-25","shortDescription":"\"The Holy Spirit is Working in Our Fathers\"  6-15-25","thumbnail":"https://i.vimeocdn.com/video/2024477786-e995b97262a2dc68ce0bd1e2f7c00e077158bf0c976ab65d109a9602940901af-d_800x450?region=us","releaseDate":"2025-06-08T11:04:27-04:00","genres":["faith"],"tags":["faith"],"content":{"dateAdded":"2025-06-15T11:01:23-04:00","duration":3896,"videos":[{"url":"https://player.vimeo.com/external/1091602933.m3u8?s=b33d50db763b6a10232e26abab5ff9bd556270ce","quality":"HD","videoType":"HLS","bitrate":null}]}}
                    ]
                };

                displayEpisodes();
                statusDiv.innerHTML = '<div class="status success">‚úÖ Successfully loaded sermon data!</div>';
                
            } catch (error) {
                statusDiv.innerHTML = `<div class="status error">‚ùå Error loading data: ${error.message}</div>`;
            }
        }

        function displayEpisodes() {
            const episodesList = document.getElementById('episodesList');
            episodesList.innerHTML = '<h3>üìª Latest Episodes</h3>';
            
            vimeoData.movies.slice(0, 5).forEach(movie => {
                const episodeDiv = document.createElement('div');
                episodeDiv.className = 'episode';
                
                const date = new Date(movie.releaseDate).toLocaleDateString();
                const duration = formatDuration(movie.content.duration);
                
                episodeDiv.innerHTML = `
                    <div class="episode-title">${escapeHtml(movie.title)}</div>
                    <div class="episode-meta">${date} ‚Ä¢ ${duration}</div>
                `;
                
                episodesList.appendChild(episodeDiv);
            });
        }

        async function generateAndSaveRSS() {
            if (!vimeoData) return;
            
            const rss = generatePodcastRSS();
            
            // Create download link for the RSS (since we can't write files directly)
            const blob = new Blob([rss], { type: 'application/xml' });
            const url = URL.createObjectURL(blob);
            
            // Add download button
            const downloadBtn = document.createElement('a');
            downloadBtn.href = url;
            downloadBtn.download = 'feed.xml';
            downloadBtn.className = 'btn';
            downloadBtn.textContent = 'Download feed.xml';
            downloadBtn.style.marginLeft = '10px';
            
            const feedInfo = document.querySelector('.feed-info div');
            feedInfo.appendChild(downloadBtn);
        }

        function generatePodcastRSS() {
            const baseUrl = currentDomain;
            const artworkUrl = config.podcastArtwork.startsWith('http') ? 
                config.podcastArtwork : `${baseUrl}/${config.podcastArtwork.replace('./', '')}`;
            
            const now = new Date().toUTCString();
            const buildDate = new Date(vimeoData.lastUpdated).toUTCString();
            
            let rss = `<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:itunes="http://www.itunes.com/dtds/podcast-1.0.dtd" xmlns:content="http://purl.org/rss/1.0/modules/content/">
<channel>
    <title>${escapeXML(config.podcastTitle)}</title>
    <link>${config.churchWebsite}</link>
    <description>${escapeXML(config.podcastDescription)}</description>
    <language>${config.podcastLanguage}</language>
    <copyright>¬© ${new Date().getFullYear()} ${escapeXML(config.podcastAuthor)}</copyright>
    <managingEditor>${config.podcastEmail} (${escapeXML(config.podcastAuthor)})</managingEditor>
    <webMaster>${config.podcastEmail} (${escapeXML(config.podcastAuthor)})</webMaster>
    <pubDate>${now}</pubDate>
    <lastBuildDate>${buildDate}</lastBuildDate>
    <generator>GitHub Pages Podcast RSS Generator</generator>
    
    <!-- iTunes Podcast Tags -->
    <itunes:author>${escapeXML(config.podcastAuthor)}</itunes:author>
    <itunes:summary>${escapeXML(config.podcastDescription)}</itunes:summary>
    <itunes:owner>
        <itunes:name>${escapeXML(config.podcastAuthor)}</itunes:name>
        <itunes:email>${config.podcastEmail}</itunes:email>
    </itunes:owner>
    <itunes:explicit>false</itunes:explicit>
    <itunes:category text="${config.podcastCategory}"${config.podcastSubcategory ? `>\n        <itunes:category text="${config.podcastSubcategory}" />\n    </itunes:category` : ' /'}">
    <itunes:image href="${artworkUrl}" />
    <itunes:type>episodic</itunes:type>
`;

            // Add episodes
            vimeoData.movies.forEach((movie, index) => {
                const episodeNumber = vimeoData.movies.length - index;
                const pubDate = new Date(movie.releaseDate).toUTCString();
                const duration = formatDuration(movie.content.duration);
                
                rss += `
    <item>
        <title>${escapeXML(movie.title)}</title>
        <description>${escapeXML(movie.shortDescription || movie.title)}</description>
        <link>https://vimeo.com/${movie.id}</link>
        <guid isPermaLink="false">vimeo-${movie.id}</guid>
        <pubDate>${pubDate}</pubDate>
        <enclosure url="${movie.content.videos[0].url}" type="application/x-mpegURL" length="0" />
        
        <!-- iTunes Episode Tags -->
        <itunes:title>${escapeXML(movie.title)}</itunes:title>
        <itunes:summary>${escapeXML(movie.shortDescription || movie.title)}</itunes:summary>
        <itunes:duration>${duration}</itunes:duration>
        <itunes:episode>${episodeNumber}</itunes:episode>
        <itunes:episodeType>full</itunes:episodeType>
        <itunes:explicit>false</itunes:explicit>
        <itunes:image href="${movie.thumbnail}" />
    </item>`;
            });

            rss += `
</channel>
</rss>`;

            return rss;
        }

        function formatDuration(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            
            if (hours > 0) {
                return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            } else {
                return `${minutes}:${secs.toString().padStart(2, '0')}`;
            }
        }

        function escapeXML(str) {
            if (!str) return '';
            return str.replace(/[<>&'"]/g, function (c) {
                switch (c) {
                    case '<': return '&lt;';
                    case '>': return '&gt;';
                    case '&': return '&amp;';
                    case '\'': return '&apos;';
                    case '"': return '&quot;';
                }
            });
        }

        function escapeHtml(str) {
            const div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        }

        function copyFeedUrl() {
            const feedUrl = document.getElementById('feedUrl').textContent;
            navigator.clipboard.writeText(feedUrl).then(() => {
                alert('Feed URL copied to clipboard!');
            });
        }

        // Initialize when page loads
        window.addEventListener('load', init);
    </script>
</body>
</html>